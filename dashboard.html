<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Red Pine</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#CE0707">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Red Pine">
  <link rel="apple-touch-icon" href="assets/images/red_pine_logo.png">
  <!-- BP-003: Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <!-- DEPLOY-004: Privacy-friendly analytics (Plausible) -->
  <!-- To enable: Replace YOUR_DOMAIN with your actual domain and uncomment -->
  <!-- <script defer data-domain="YOUR_DOMAIN" src="https://plausible.io/js/script.js"></script> -->
  <!-- Alternative: Self-hosted analytics tracking -->
  <script>
    // Simple analytics event tracking
    window.trackEvent = function(name, props = {}) {
      if (typeof plausible !== 'undefined') {
        plausible(name, { props });
      }
      // Also log to console in development
      if (window.location.hostname === 'localhost') {
        console.log('[Analytics]', name, props);
      }
    };
  </script>
</head>
<body>
  <!-- Mobile hamburger menu -->
  <button class="hamburger-menu" onclick="toggleMobileMenu()" aria-label="Toggle menu">
    <i data-lucide="menu"></i>
  </button>
  <div class="sidebar-overlay" onclick="toggleMobileMenu()"></div>

  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-logo">
        <img src="assets/images/red_pine_logo.png" alt="Red Pine" id="brandLogo">
      </div>

      <nav>
        <ul class="sidebar-nav">
          <li><a href="dashboard.html" class="active"><i data-lucide="layout-dashboard"></i> Dashboard</a></li>
          <li><a href="beats.html"><i data-lucide="music"></i> Beats</a></li>
          <li><a href="store.html"><i data-lucide="store"></i> Store</a></li>
          <li><a href="customers.html"><i data-lucide="users"></i> Customers</a></li>
          <li><a href="analytics.html"><i data-lucide="bar-chart-3"></i> Analytics</a></li>
          <li><a href="settings.html"><i data-lucide="settings"></i> Settings</a></li>
        </ul>
      </nav>

      <div class="sidebar-logout">
        <button class="btn-logout" id="logoutBtn"><i data-lucide="log-out"></i> Logout</button>
      </div>

      <div class="powered-by">
        <a href="https://redpine.systems" target="_blank">
          <span>Powered by</span>
          <img src="assets/images/red_pine_logo.png" alt="Red Pine">
        </a>
      </div>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
      <div class="top-bar">
        <h1 class="page-title">Dashboard</h1>
        <div style="display: flex; align-items: center; gap: 16px;">
          <!-- Theme Toggle -->
          <div class="theme-toggle-wrapper">
            <i data-lucide="sun" style="width:16px;height:16px;"></i>
            <label class="theme-toggle">
              <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
              <span class="theme-toggle-slider"></span>
            </label>
            <i data-lucide="moon" style="width:16px;height:16px;"></i>
          </div>

        </div>
      </div>

      <!-- Quick Actions - Moved to top right -->
      <div class="quick-actions" style="margin-bottom: 24px;">
        <div style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: flex-end;">
          <a href="beats.html" class="btn btn-primary" onclick="event.preventDefault(); openUploadModal();">
            <i data-lucide="upload"></i> Upload Beat
          </a>
          <a href="customize.html" class="btn btn-secondary">
            <i data-lucide="palette"></i> Edit Store
          </a>
          <a href="analytics.html" class="btn btn-secondary">
            <i data-lucide="bar-chart-3"></i> View Analytics
          </a>
        </div>
      </div>
      
      <div id="welcomeMessage" style="margin-bottom: 24px; font-size: 18px; color: var(--gray-dark);"></div>
      
      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Beats</div>
          <div class="stat-value" id="totalBeats">0</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Total Views</div>
          <div class="stat-value" id="totalViews">0</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Total Customers</div>
          <div class="stat-value" id="totalCustomers">0</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Total Sales</div>
          <div class="stat-value" id="totalSales">0</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Revenue</div>
          <div class="stat-value" id="totalRevenue">$0</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Conversion Rate</div>
          <div class="stat-value" id="conversionRate">0%</div>
        </div>
      </div>

      <!-- Dashboard Widgets -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 32px;">
        <!-- Revenue Chart Widget (DB-009) -->
        <a href="analytics.html" class="stat-card" style="text-decoration: none; cursor: pointer;">
          <div class="stat-label">Revenue - Last 7 Days</div>
          <div style="display: flex; align-items: center; gap: 16px;">
            <div class="stat-value" id="revenue7Days">$0</div>
            <div id="revenueTrend" style="display: flex; align-items: center; gap: 4px; font-size: 14px; color: #10B981;">
              <i data-lucide="trending-up" style="width: 16px; height: 16px;"></i>
              <span id="revenueTrendPercent">0%</span>
            </div>
          </div>
          <div id="revenueSparkline" style="height: 40px; margin-top: 12px;">
            <svg width="100%" height="40" viewBox="0 0 200 40" preserveAspectRatio="none">
              <polyline id="sparklinePath" fill="none" stroke="var(--red)" stroke-width="2" points="0,35 30,30 60,25 90,28 120,20 150,15 180,18 200,10"/>
            </svg>
          </div>
        </a>

        <!-- New Customers Widget (DB-010) -->
        <a href="customers.html" class="stat-card" style="text-decoration: none; cursor: pointer;">
          <div class="stat-label">New Customers This Month</div>
          <div style="display: flex; align-items: center; gap: 16px;">
            <div class="stat-value" id="newCustomersMonth">0</div>
            <div id="customersTrend" style="display: flex; align-items: center; gap: 4px; font-size: 14px; color: #10B981;">
              <i data-lucide="trending-up" style="width: 16px; height: 16px;"></i>
              <span id="customersTrendText">+0 from last month</span>
            </div>
          </div>
          <div style="margin-top: 12px; font-size: 13px; color: var(--gray-dark);">
            <span id="customersTrendPercent">0%</span> compared to last month
          </div>
        </a>
      </div>

      <!-- Recent Sales Table -->
      <div class="table-container">
        <div class="table-header">
          <h2>Recent Sales</h2>
        </div>
        <table>
          <thead>
            <tr>
              <th>Beat</th>
              <th>Customer</th>
              <th>License</th>
              <th>Amount</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="salesTableBody">
            <tr>
              <td colspan="5" style="text-align: center; color: var(--gray-dark);">
                <div class="spinner"></div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </main>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="assets/js/config.js"></script>
  <script src="assets/js/branding.js"></script>
  <script src="assets/js/dashboard.js"></script>
  <script>
    // Initialize Lucide icons
    lucide.createIcons();

    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => console.log('SW registered:', registration.scope))
          .catch(error => console.log('SW registration failed:', error));
      });
    }
  </script>
</body>
</html>
